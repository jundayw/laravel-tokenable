---
title: 令牌管理
lang: zh-CN
---

# 令牌管理

```php
/*
|-----------------------------------------------------------------------------------------
| 令牌管理
|-----------------------------------------------------------------------------------------
|
| 管理如何在不同平台类型之间处理用户身份验证令牌。
| 这些选项定义用户是否可以维护
| 并发令牌，以及如何处理每个平台类型的多个令牌。
|
*/

'token_management' => [
    
    /*
    |-----------------------------------------------------------------------------------
    | 已启用
    |-----------------------------------------------------------------------------------
    |
    | 确定令牌并发控制是否处于活动状态。
    | 设置为 true 时，将应用强制执行令牌并发限制的规则。
    |
    */
    
    'enabled' => true,
    
    /*
    |--------------------------------------------------------------------------------------
    | 允许多个平台
    |--------------------------------------------------------------------------------------
    |
    | 设置为 true 时，不同平台（例如，“PC”、“移动”、“应用”）的令牌
    | 可以同时保持有效。
    |如果为 false，则发放新令牌将使所有现有令牌失效
    | 无论平台如何。
    |
    |
    */
    
    'allow_multi_platforms' => true,
    
    /*
    |--------------------------------------------------------------------------
    | 多平台令牌
    |---------------------------------------------------------------------------
    |
    | 允许同一用户同时拥有多个有效令牌的平台列表
    | 。
    | 示例：['pc'] 允许同时为 PC 平台拥有多个令牌。
    |
    */
    
    'multi_platform_tokens' => [],
],
```

管理如何在不同平台类型之间处理用户身份验证令牌。
这些选项定义用户是否可以维护并发令牌以及如何处理每个平台类型的多个令牌。

- `enabled`: 是否启用令牌管理。默认为 `true`。
- `allow_multi_platforms`: 是否允许用户在不同平台类型之间维护多个令牌。默认为 `true`。
- `multi_platform_tokens`: 允许同一用户同时拥有多个活动令牌的平台列表。

::: tip
`allow_multi_platforms`
设置为 `true` 时，不同平台（例如，`PC`、`mobile`、`App`）的令牌可以同时保持有效。
设置为 `false` 时，无论平台如何，发放新令牌都将使所有现有令牌失效。
:::

::: tip
`multi_platform_tokens`
允许同一用户同时拥有多个活动令牌的平台列表。
示例：['pc'] 允许同时为 `PC` 平台使用多个令牌。
:::

## 配置优先级

`config/auth.php` 中的 `guards` 配置优先于 `config/tokenable.php` 中的 `token_management` 配置，因此可以在 `config/auth.php` 中覆盖 `config/tokenable.php` 中的配置。

```php
'guards' => [
    'api' => [
        'driver' => 'tokenable',
        'provider' => 'users',
        'allow_multi_platforms' => false,
    ],
    'web' => [
        'driver' => 'tokenable',
        'provider' => 'users',
        'allow_multi_platforms' => true,
        'multi_platform_tokens' => ['pc', 'h5'],
    ],
],
```

上述配置将允许同一用户 `PC` 和 `H5` 平台各签发一个令牌，但 `API` 平台仅有一个最新令牌有效。

```php
use Illuminate\Support\Facades\Auth;
// api
Auth::guard('api')->login($user)->createToken('API Token');
// web
Auth::guard('web')->login($user)->createToken('PC Token', 'pc');
Auth::guard('web')->login($user)->createToken('H5 Token', 'h5');
```
