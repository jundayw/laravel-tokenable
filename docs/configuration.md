---
title: 配置
lang: zh-CN
---

```php
<?php

return [
    
    /*
    |--------------------------------------------------------------------------
    | 默认令牌驱动程序
    |---------------------------------------------------------------------------
    |
    | 此选项控制 TokenManager 使用的默认令牌驱动程序。
    | 您可以选择“hash”或“jwt”，或者注册您自己的驱动程序。
    |
    */
    
    'default' => [
        'driver' => env('TOKEN_DRIVER', 'jwt'),
    ],
    
    /*
    |-----------------------------------------------------------------------------------------
    | 令牌管理
    |-----------------------------------------------------------------------------------------
    |
    | 管理如何在不同平台类型之间处理用户身份验证令牌。
    | 这些选项定义用户是否可以维护
    | 并发令牌，以及如何处理每个平台类型的多个令牌。
    |
    */
    
    'token_management' => [
        
        /*
        |-----------------------------------------------------------------------------------
        | 已启用
        |-----------------------------------------------------------------------------------
        |
        | 确定令牌并发控制是否处于活动状态。
        | 设置为 true 时，将应用强制执行令牌并发限制的规则。
        |
        */
        
        'enabled' => true,
        
        /*
        |--------------------------------------------------------------------------------------
        | 允许多个平台
        |--------------------------------------------------------------------------------------
        |
        | 设置为 true 时，不同平台（例如，“PC”、“移动”、“应用”）的令牌可以同时保持有效。
        | 如果为 false，则发放新令牌将使所有现有令牌失效无论平台如何。
        |
        |
        */
        
        'allow_multi_platforms' => true,
        
        /*
        |--------------------------------------------------------------------------
        | 多平台令牌
        |---------------------------------------------------------------------------
        |
        | 允许同一用户同时拥有多个有效令牌的平台列表。
        | 示例：['pc'] 允许同时为 PC 平台拥有多个令牌。
        |
        */
        
        'multi_platform_tokens' => [],
    ],
    
    /*
    |--------------------------------------------------------------------------
    | 是否启用令牌暂停
    |--------------------------------------------------------------------------
    |
    | 此选项决定是否启用令牌暂停功能。
    | 设置为 false 时禁用令牌暂停。
    |
    */
    
    'suspend_enabled' => env('TOKEN_SUSPEND_ENABLED', true),
    
    /*
    |--------------------------------------------------------------------------------------
    | 访问令牌有效期 (TTL)
    |--------------------------------------------------------------------------------------
    |
    | 此值定义已颁发的访问令牌在过期前保持有效的秒数。
    | 过期后，令牌将无法再用于访问受保护的资源。
    |
    */
    
    'ttl' => env('TOKEN_TTL', 7200),
    
    /*
    |-----------------------------------------------------------------------------------
    | 刷新令牌不早于时间
    |-----------------------------------------------------------------------------------
    |
    | 此值定义颁发后，刷新令牌在多少秒内无法使用。
    | 这允许强制执行最短等待时间。
    | 客户端可以使用刷新令牌请求新的访问令牌。
    |
    */
    
    'refresh_nbf' => env('TOKEN_REFRESH_NBF', 3600),
    
    /*
    |--------------------------------------------------------------------------
    | 刷新令牌有效期
    |---------------------------------------------------------------------------
    |
    | 此值控制刷新令牌的总有效期。它可以表示为相对间隔（例如，“P15D”表示 15 天）。
    | 一旦刷新令牌过期，客户端必须重新进行身份验证才能获取新令牌。
    |
    */
    
    'refresh_ttl' => env('TOKEN_REFRESH_TTL', 'P15D'),
    
    /*
    |---------------------------------------------------------------------------
    | 授权码有效期
    |---------------------------------------------------------------------------------------
    |
    | 此值定义授权码的有效期。由于这些由于授权码的有效期较短，因此可以快速交换访问
    | 令牌，其有效期应非常短（通常为 30-300 秒）。授权码过期后，客户端必须重新启动
    | 授权流程才能获取新的授权码。
    |
    */
    
    'auth_code_ttl' => env('TOKEN_AUTH_CODE_TTL', 60),
    
    /*
    |--------------------------------------------------------------------------
    | 密钥存储路径
    |---------------------------------------------------------------------------
    |
    | 存储私钥和公钥的基本目录。此路径将添加到 private_key 和 public_key 文件名的前面。
    | 您也可以使用环境变量来配置此路径。
    |
    */
    
    'key_path' => env('TOKEN_KEY_PATH', storage_path('keys')),

    /*
    |--------------------------------------------------------------------------
    | 令牌驱动程序
    |---------------------------------------------------------------------------
    |
    | 您可以在此处配置应用程序使用的所有令牌驱动程序。
    | 每个驱动程序都可以将自己的一组选项传递给其构造函数。
    |
    */

    'drivers' => [

        'hash' => [
            
            /*
            |--------------------------------------------------------------------------
            | 哈希/签名算法
            |---------------------------------------------------------------------------
            |
            | 此值决定用于对令牌进行签名或哈希处理的算法。
            | 您可以根据应用程序的安全要求进行调整。
            |
            | 支持：@link https://php.net/manual/en/function.hash-hmac.php
            |
            */
            
            'algo' => env('TOKEN_HASH_ALGO', 'sha256'),
            
            /*
            |--------------------------------------------------------------------------
            | 令牌密钥
            |---------------------------------------------------------------------------
            |
            | 此密钥用于对应用程序颁发的令牌进行签名或验证。
            | 默认情况下，它会回退到应用程序的 APP_KEY。您应该确保此密钥始终保持保密和安全。
            |
            */
            
            'secret_key' => env('TOKEN_SECRET_KEY', env('APP_KEY')),
        ],

        'jwt' => [
            
            /*
            |--------------------------------------------------------------------------
            | 用于签名和验证的加密算法
            |---------------------------------------------------------------------------
            |
            | 此选项决定用于签名和验证 JWT 令牌的加密算法。您可以选择非对称算法
            | （RS256、RS384、RS512、ES256、ES384、ES512、EdDSA）或对称算法（HS256、HS384、HS512）。
            |
            | - RS*、ES*、EdDSA：需要 private_key（签名）和 public_key（验证）。推荐用于分布式系统。
            |
            | - HS*：只需要 secret_key。更简单但灵活性较差，推荐用于单服务部署。
            |
            | 出于兼容性考虑，默认为 HS256，但您应该考虑更强大的算法可以使用 RS384 或 ES384 等算法来提高安全性。
            |
            */
            
            'algo' => env('TOKEN_ALGO', 'HS256'),
            
            /*
            |--------------------------------------------------------------------------
            | 私钥
            |---------------------------------------------------------------------------
            |
            | 私钥用于在使用非对称算法（例如 RS256、RS512 或 ES512）时对令牌进行签名。
            | 此密钥必须严格保密，
            | 切勿公开。
            |
            | 您可以指定 PEM 文件的路径，也可以直接从环境变量或安全密钥管理器加载密钥。
            | 从环境变量或安全密钥管理器加载密钥。
            |
            */
            
            'private_key' => env('TOKEN_PRIVATE_KEY', 'tokenable-private.key'),
            
            /*
            |---------------------------------------------------------------------------------------
            | 公钥
            |---------------------------------------------------------------------------------------
            |
            |公钥用于验证使用非对称算法（例如 RS256、RS512 或 ES512）签名的令牌。
            | 对应的私钥签名的令牌。
            | 此密钥可以安全地与其他需要验证令牌的服务或客户端共享。
            |
            | 您可以指定 PEM 文件的路径，或直接从环境变量或安全密钥管理器加载密钥。
            |
            */
            
            'public_key' => env('TOKEN_PUBLIC_KEY', 'tokenable-public.key'),
            
            /*
            |--------------------------------------------------------------------------
            | 密钥
            |---------------------------------------------------------------------------------------
            |
            | 此密钥用于在使用对称算法（例如 HMAC，HS256、HS512）签名令牌时使用。
            | 必须以纯文本形式提供，并且可以通过环境变量进行设置以方便使用。
            |
            */
            
            'secret_key' => env('TOKEN_SECRET_KEY', env('APP_KEY')),
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Authentication Guards
    |--------------------------------------------------------------------------
    |
    | Next, you may define every authentication guard for your application.
    | Of course, a great default configuration has been defined for you
    | here which uses session storage and the Eloquent user provider.
    |
    | All authentication drivers have a user provider. This defines how the
    | users are actually retrieved out of your database or other storage
    | mechanisms used by this application to persist your user's data.
    |
    | Supported: "session"
    |
    */

    'guards' => [],

    /*
    |-----------------------------------------------------------------------------------------
    | 数据库存储配置
    |-----------------------------------------------------------------------------------------
    |
    | 您可以在此处配置令牌在应用程序的
    | 数据库中的持久化方式。此部分允许您定义应使用的数据库连接，
    | 以及所有已颁发令牌将存储到的特定表。
    | 通过自定义这些设置，您可以根据需要将令牌存储与主应用程序表隔离。
    |
    */
    
    'database' => [
        
        /*
        |---------------------------------------------------------------------------
        | 数据库连接
        |---------------------------------------------------------------------------
        |
        | 此选项指定应使用的数据库连接，
        | 用于存储和管理已颁发令牌。默认情况下，如果环境文件中未定义特定的
        | TOKEN_CONNECTION，则回退到应用程序的主数据库连接。
        |
        |
        */
        
        'connection' => env('TOKEN_CONNECTION', env('DB_CONNECTION', 'mysql')),
        
        /*
        |--------------------------------------------------------------------------
        | 令牌存储表
        |---------------------------------------------------------------------------
        |
        | 此表用于持久化所有生成的令牌及其元数据，包括访问令牌、刷新令牌、到期时间和撤销状态。
        | 如果您希望将令牌存储在自定义表中，可以更改此表名称。
        |
        |
        */
        
        'table' => env('TOKEN_TABLE', 'auth_tokens'),
    ],

    /*
    |-----------------------------------------------------------------------
    | 令牌队列配置
    |---------------------------------------------------------------------------------------
    |
    | 此部分定义用于处理令牌相关任务（例如签发、刷新或）的队列连接和队列名称异步撤销令牌。
    |
    | 您可以将连接配置为使用 Laravel 支持的任何队列驱动程序，
    | 例如，"sync"、"database"、"redis"、"sqs" 等。
    |
    */
    
    'queue' => [
    
        /*
        |--------------------------------------------------------------------------
        | 令牌队列连接
        |---------------------------------------------------------------------------
        |
        | 用于令牌任务的队列连接。
        |
        | 如果设置为 'sync'，任务将在当前进程中立即执行。
        |
        */
        
        'connection' => env('TOKEN_QUEUE_CONNECTION', env('QUEUE_CONNECTION', 'sync')),
        
        /*
        |---------------------------------------------------------------------------
        | 令牌队列的工作队列
        |---------------------------------------------------------------------------
        |
        | 令牌任务将被推送到的队列的名称。
        |
        | 这对于将令牌作业与其他应用程序作业分开非常有用，并且允许优先级或专用工作器。
        |
        */
        
        'queue' => env('TOKEN_QUEUE', 'default'),
    ],

    /*
    |--------------------------------------------------------------------------
    | 令牌缓存配置
    |---------------------------------------------------------------------------
    |
    | 配置用于管理令牌状态的缓存支持机制，
    | 例如黑名单和白名单查找。
    | 缓存用作快速查找层，以减少数据库命中。
    | 当同时启用黑名单和白名单时，黑名单检查优先。
    |
    */
    
    'cache' => [
        
        /*
        |---------------------------------------------------------------------------------------
        | 令牌缓存存储
        |---------------------------------------------------------------------------------------
        |
        | 用于管理令牌状态（黑名单/白名单）的缓存存储。
        | 您可以指定 cache.php 配置文件中定义的任何存储，例如“redis”、“memcached”、“file”或“database”。
        |
        */
        
        'driver' => env('TOKEN_CACHE_DRIVER', env('CACHE_DRIVER', 'file')),
        
        /*
        |--------------------------------------------------------------------------
        | 黑名单功能
        |---------------------------------------------------------------------------
        |
        | 启用或禁用令牌黑名单功能。
        | 启用后，添加到黑名单的令牌将被视为无效，并被拒绝访问，无论其过期状态如何。
        |
        */
        
        'blacklist_enabled' => env('TOKEN_BLACKLIST_ENABLED', true),
        
        /*
        |--------------------------------------------------------------------------------------
        | 白名单功能
        |--------------------------------------------------------------------------------------
        |
        | 启用或禁用令牌白名单功能。
        | 启用后，添加到白名单的令牌将始终被视为有效，并被授予访问权限，只要它们在数据库中未过期或被撤销。
        |
        */
        
        'whitelist_enabled' => env('TOKEN_WHITELIST_ENABLED', false),
        
        /*
        |--------------------------------------------------------------------------
        | 令牌缓存键前缀
        |---------------------------------------------------------------------------
        |
        | 此值将被添加到所有与令牌相关的缓存键的前面，以防止跨不同应用程序或环境的命名冲突。
        |
        */
        
        'prefix' => env('TOKEN_CACHE_PREFIX', 'tokenable:'),
    ],

];
```
